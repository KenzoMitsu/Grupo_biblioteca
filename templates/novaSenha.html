<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <title>Nova Senha</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fontes e estilos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/login.css">
    <link rel="icon" type="image/x-icon" href="../static/img/head-removebg-preview.png">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.13/dist/sweetalert2.all.min.js"></script>
</head>

<body>

    <section class="tudo d-flex justify-content-center align-items-center flex-wrap p-4">
        <div>
            <img class="livro-1" src="../static/img/login-image.png" alt="Imagem de recuperação"
                style="max-width: 300px;">
        </div>

        <div class="formulario" style="min-width: 300px; max-width: 400px;">
            <h1 class="titulo">Redefinir Senha</h1>

            <form id="formNovaSenha" class="login" onsubmit="enviarNovaSenha(event)">
                <label class="coisa" for="nSenha">Sua Nova Senha:</label>
                <input placeholder="Insira sua nova senha" class="inserir form-control mb-2" type="password" id="nSenha"
                    name="nSenha" required>

                <label class="coisa mt-2" for="confirmaSenha">Confirme Sua Nova Senha:</label>
                <input placeholder="Confirme sua nova senha" class="inserir form-control mb-3" type="password"
                    id="confirmaSenha" name="confirmaSenha" required>

                <button type="submit" class="botao-login btn btn-primary w-100">Salvar Nova Senha</button>
            </form>

            <p class="texto mt-3 text-center">Lembrou da senha? <a class="link" href="login.html">Voltar para login</a>
            </p>
        </div>
    </section>

    <script>
        const ipPython = "http://192.168.1.121:5000"; // Substitua pelo IP correto

        async function enviarNovaSenha(event) {
            event.preventDefault();

            const novaSenha = document.getElementById('nSenha').value;
            const confirmaSenha = document.getElementById('confirmaSenha').value;

            if (!novaSenha || !confirmaSenha) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Campos vazios!',
                    text: 'Preencha todos os campos.'
                });
                return;
            }

            if (novaSenha !== confirmaSenha) {
                Swal.fire({
                    icon: 'error',
                    title: 'Senhas diferentes!',
                    text: 'As senhas não coincidem.'
                });
                return;
            }

            try {
                const response = await fetch(ipPython + '/nova_senha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ novaSenha })
                });

                const data = await response.json();

                if (response.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Sucesso!',
                        text: 'Senha redefinida com sucesso.'
                    }).then(() => {
                        window.location.href = 'login.html';
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro!',
                        text: `Erro ao redefinir senha: ${data.error}`
                    });
                }
            } catch (error) {
                console.error(error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro!',
                    text: 'Erro de conexão com o servidor.'
                });
            }
        }
    </script>

</body>

</html>
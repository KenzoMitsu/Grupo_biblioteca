<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/login.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="../static/js/paginaip.js"></script>

    <title>Login</title>
    <link rel="icon" type="image/x-icon" href="../static/img/head-removebg-preview.png">
</head>

<body>

    <header>

        <img class="logo-header" src="../static/img/logo.png" alt="">

    </header>

    <section class="tudo">

        <div>

            <img class="livro-1" src="../static/img/login-image.png" alt="">

        </div>

        <div class="formulario">

            <h1 class="titulo">Login</h1>


            <form id="formLoginUsuario" class="login">
                <label class="coisa" for="email">Email:</label>
                <input placeholder="email@email.com" type="text" placeholder="email@email.com" class="inserir"
                    type="email" id="email" name="email" required>

                <label class="coisa" for="senha">Senha:</label>
                <input placeholder="Sua senha" type="password" placeholder="Sua senha" class="inserir" type="password"
                    id="senha" name="senha" required>
            </form>

            <div class="final">
                <button onclick="$('#formLoginUsuario').submit()" class="botao-login">Login</button>

                <p class="texto">Não possui uma conta? <a target="_blank" class="link"
                        href="cadastro.html">Cadastre-se</a></p>
            </div>

        </div>

        <script>

            $("#formLoginUsuario").on("submit", function (e) {

                e.preventDefault();

                let dados = new FormData(this);


                let envia = {
                    email: dados.get("email"),
                    senha: dados.get("senha"),
                }

                envia = JSON.stringify(envia)

                $.ajax({
                    method: "post",
                    url: 'http://10.92.3.208:5000' + "/login",
                    contentType: "application/json",
                    data: envia,

                    success: function (retorno) {

                        localStorage.setItem("token", retorno.token)
                        localStorage.setItem("id_usuario", retorno.usuario.id_usuario)
                        localStorage.setItem("nome", retorno.usuario.nome)
                        localStorage.setItem("cargo", retorno.usuario.cargo)
                        localStorage.setItem("email", retorno.usuario.email)
                        localStorage.setItem("multa", retorno.usuario.multa)
                        localStorage.setItem("data_nascimento", retorno.usuario.data_nascimento)
                        localStorage.setItem("telefone", retorno.usuario.telefone)
                        localStorage.setItem("imagem_usuario", retorno.usuario.imagem_usuario)

                        var cargo = localStorage.getItem("cargo")

                        if (cargo === "ADM") {
                            Swal.fire({
                                title: "Sucesso!",
                                text: "Login de ADM realizado com sucesso",
                                icon: "success"
                            }).then((result) => {
                                window.location.href = "homeADM.html";
                            });
                        } else if (cargo === "Biblitecario") {
                            Swal.fire({
                                title: "Sucesso!",
                                text: "Login de Biblitecário realizado com sucesso",
                                icon: "success"
                            }).then((result) => {
                                window.location.href = "homeBiblio.html"
                            });
                        } else {
                            Swal.fire({
                                title: "Sucesso!",
                                text: "Login realizado com sucesso",
                                icon: "success"
                            }).then((result) => {
                                window.location.href = "home.html"
                            })
                        };

                    },


                    error: function (retorno) {
                        Swal.fire({
                            title: "Inválido!",
                            text: "Usuário ou senha inválidos",
                            icon: "error"
                        });
                    }

                })

            })

        </script>

    </section>

</body>

</html>
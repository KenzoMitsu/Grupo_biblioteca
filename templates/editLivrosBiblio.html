<!DOCTYPE html>
<html lang="pt-BR" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Livros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Sans+JP:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

    <link rel="stylesheet" href="../static/css/livros.css" />

    <link rel="stylesheet" href="../static/dist/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/dist/assets/owl.theme.default.min.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="../static/dist/owl.carousel.min.js"></script>
    <script src="../static/js/scripts.js"></script>
    <script src="../static/js/seguranca.js" defer></script>
    <script src="../static/js/segurancaBiblio.js" defer></script>
    <link rel="icon" type="image/x-icon" href="../static/img/head-removebg-preview.png">
</head>

<head>
    <!-- SEGURANÇA DO SITE (IMPEDE A NAVEGAÇÃO P' OUTRAS PÁGINAS APENAS POR MEIO DO LINK) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="../static/js/paginaip.js"></script>
    <script src="../static/js/scripts.js"></script>
    <script src="../static/js/seguranca.js" defer></script>
    <!-- FIM DO SCRIPT DA SEGURANÇA -->
    <link rel="icon" type="image/x-icon" href="../static/img/head-removebg-preview.png">
</head>

<body>
    <header>
        <!-- Logo -->
        <div class="header-left">
            <a id="logoHeader" href=""><img src="../static/img/logo.png" alt="Logo"></a>
        </div>

        <!-- Barra de Pesquisa -->
        <div class="header-center">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Pesquise Seu Livro" class="search-box">
            </div>
        </div>

        <!-- Dark Mode -->
        <div class="header-right">
            <div class="switch-container">
                Dark Mode
                <label class="switch">
                    <input id="alternarTema" type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Ícone de Menu com Dropdown -->
        <div class="header-end">
            <div class="menu-container">
                <div class="menu-icon" id="menuButton">
                    <div class="menulinha"></div>
                    <div class="menulinha"></div>
                    <div class="menulinha"></div>
                </div>

                <ul class="dropdown-menu" id="dropdownMenu">

                    <li class="menu-item"><i class="fa-solid fa-circle-user"></i><a href="editPerfil.html"> Perfil</a>
                    </li>

                    <div id="cliente">
                        <li class="menu-item"><i class="fas fa-book"></i><a href="emprestimos.html">Empréstimos</a></li>
                        <li class="menu-item"><i class="fas fa-sync-alt"></i><a href="historico.html">Histórico</a></li>
                    </div>



                    <div id="adm">
                        <li class="menu-item"><i class="fa-solid fa-user-plus"></i><a
                                href="addUsuarioADM.html">Adicionar Usuário</a></li>

                        <li class="menu-item"><i class="fas fa-user"></i><a href="usuariosADM.html"> Gerenciar
                                Usuários</a></li>

                        <li class="menu-item"><i class="fa-solid fa-file-export"></i><a
                                href="relatoriosADM.html">Relatórios</li></a>

                        <li class="menu-item"><i class="fa-solid fa-cash-register"></i><a
                                href="multasADM.html">Gerenciar Multas</li></a>

                        <li class="menu-item"><i class="fas fa-book"></i><a href="editLivrosADM.html">Gerenciar Livros
                        </li></a>

                        <li class="menu-item"><i class="fas fa-sync-alt"></i><a href="emprestimosADM.html">Empréstimos
                        </li></a>

                    </div>

                    <div id="biblio">
                        <li class="menu-item"><i class="fas fa-book"></i><a href="emprestimosBiblio.html">
                                Empréstimos</a></li>

                        <li class="menu-item"><i class="fa-solid fa-file-export"></i><a
                                href="relatoriosBiblio.html">Relatórios</a></li>

                        <li class="menu-item"><i class="fas fa-sync-alt"></i><a href="livrosBiblio.html"> Gerenciar
                                Livros</a></li>
                    </div>

                    <li class="menu-item"><i class="fas fa-sign-out-alt"></i><button class="sair ">Sair</button>
                    </li>
                </ul>

            </div>
        </div>
    </header>

    <!-- Carousel para exibir livros -->
    <div class="container mt-4">
        <div class="owl-carousel owl-theme" id="livros-carousel">
            <!-- Os livros serão inseridos aqui via JavaScript -->
        </div>
    </div>

    <!-- Modal para Edição -->
    <div id="modal-edicao" style="display: none;">
        <form id="form-edicao">

            <input type="hidden" id="id_livro">

            <label>Título:</label>
            <input type="text" id="titulo" required class="form-control">

            <label>Autor:</label>
            <input type="text" id="autor" required class="form-control">

            <label>Data de Publicação:</label>
            <input type="date" id="data_publicacao" required class="form-control">

            <label>ISBN:</label>
            <input type="text" id="ISBN" required class="form-control">
            <label>Descrição:</label>
            <textarea id="descricao" required class="form-control"></textarea>
            <label>Quantidade:</label>
            <input type="number" id="quantidade" required class="form-control">
            <label>Categoria:</label>
            <input type="text" id="categoria" required class="form-control">
            <button type="submit" class="btn btn-primary">Salvar</button>
            <button type="button" id="fechar-modal" class="btn btn-secondary">Cancelar</button>
        </form>
    </div>

    <footer class="inter">
        <div class="separacao1">
            <p>Entre em contato conosco</p>
            <div class="redes">
                <a href="https://www.whatsapp.com/?lang=pt_BR"><i class="fa-brands fa-whatsapp"></i></a>
                <a href="https://www.instagram.com"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://br.linkedin.com"><i class="fa-brands fa-linkedin"></i></a>
                <a href="https://x.com/?lang=pt"><i class="fa-brands fa-twitter"></i></a>
                <a href="https://pt-br.facebook.com/login/device-based/regular/login/"><i
                        class="fa-brands fa-facebook"></i></a>
            </div>
        </div>
        <div class="rodape-inter">
            <div class="informacao">
                <p class="informacoes">INFORMAÇÕES</p>
                <div class="linha"></div>
                <div class="display">
                    <i class="fa-solid fa-envelope icons"></i>
                    <p class="text">asa.literaria@email.com</p>
                </div>
                <div class="display">
                    <i class="fa-solid fa-phone icons"></i>
                    <p class="text">(18)99999-9999</p>
                </div>
            </div>
            <div class="imagem">
                <img class="logo_rodape" src="../static/img/logo.png" alt="logo">
            </div>
            <div class="localizacao">
                <p class="local">LOCALIZAÇÃO<br>Birigui - SP</p>
            </div>
        </div>
        <div class="as">
            <a href="https://www.google.com.br/?hl=pt-BR" class="text2">Termos de Uso</a>
            <a href="https://www.google.com.br/?hl=pt-BR" class="text2">Política de privacidade</a>
        </div>
    </footer>

    <script>
        $(document).ready(function () {
            carregarLivros(); // Carrega os livros ao iniciar a página

            function carregarLivros() {
                $.ajax({
                    method: "GET",
                    url: ipPython + "/livros",
                    success: function (data) {
                        let livros = data.livros; // Supondo que a resposta tenha um array de livros
                        let carousel = $("#livros-carousel");
                        carousel.empty(); // Limpa o carousel antes de adicionar novos livros

                        livros.forEach(livro => {
                            let item = `
                                <div class="item">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">${livro.titulo}</h5>
                                            <p class="card-text">Autor: ${livro.autor}</p>
                                            <p class="card-text">ISBN: ${livro.ISBN}</p>
                                            <p class="card-text">Quantidade: ${livro.quantidade}</p>
                                            <button class="btn btn-warning editar-btn" data-id="${livro.id_livro}">Editar</button>
                                            <button class="btn btn-danger excluir-btn" data-id="${livro.id_livro}">Excluir</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            carousel.append(item);
                        });

                        // Inicializa o carousel
                        carousel.owlCarousel({
                            loop: true,
                            margin: 10,
                            nav: true,
                            responsive: {
                                0: { items: 1 },
                                600: { items: 2 },
                                1000: { items: 3 }
                            }
                        });

                        // Evento de clique para editar
                        $(".editar-btn").click(function () {
                            let id = $(this).data("id");
                            // Carregar os dados do livro para edição
                            $.ajax({
                                method: "GET",
                                url: `/livros/${id}`, // URL para buscar os detalhes do livro
                                success: function (livro) {
                                    $("#id_livro").val(livro.id_livro);
                                    $("#titulo").val(livro.titulo);
                                    $("#autor").val(livro.autor);
                                    $("#data_publicacao").val(livro.data_publicacao);
                                    $("#ISBN").val(livro.ISBN);
                                    $("#descricao").val(livro.descricao);
                                    $("#quantidade").val(livro.quantidade);
                                    $("#categoria").val(livro.categoria);
                                    $("#modal-edicao").show(); // Exibe o modal
                                }
                            });
                        });

                        // Evento de clique para excluir
                        $(".excluir-btn").click(function () {
                            let id = $(this).data("id");
                            Swal.fire({
                                title: 'Tem certeza?',
                                text: "Você não poderá reverter isso!",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#d33',
                                cancelButtonColor: '#3085d6',
                                confirmButtonText: 'Sim, excluir!'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    $.ajax({
                                        method: "DELETE",
                                        url: `/livros/${id}`, // URL para excluir o livro
                                        success: function () {
                                            Swal.fire('Excluído!', 'O livro foi excluído.', 'success');
                                            carregarLivros(); // Atualiza a lista de livros
                                        },
                                        error: function (retorno) {
                                            Swal.fire({
                                                title: "Inválido!",
                                                text: JSON.parse(retorno.responseText).error,
                                                icon: "error"
                                            });
                                        }
                                    });
                                }
                            });
                        });
                    },
                    error: function (retorno) {
                        Swal.fire({
                            title: "Inválido!",
                            text: JSON.parse(retorno.responseText).error,
                            icon: "error"
                        });
                    }
                });
            }

            // Evento para fechar o modal
            $("#fechar-modal").click(function () {
                $("#modal-edicao").hide();
            });

            // Evento para salvar as edições
            $("#form-edicao").submit(function (e) {
                e.preventDefault();
                let id = $("#id_livro").val();
                let titulo = $("#titulo").val();
                let autor = $("#autor").val();
                let data_publicacao = $("#data_publicacao").val();
                let ISBN = $("#ISBN").val();
                let descricao = $("#descricao").val();
                let quantidade = $("#quantidade").val();
                let categoria = $("#categoria").val();

                $.ajax({
                    method: "PUT",
                    url: `/livros/${id}`, // URL para editar o livro
                    data: {
                        titulo: titulo,
                        autor: autor,
                        data_publicacao: data_publicacao,
                        ISBN: ISBN,
                        descricao: descricao,
                        quantidade: quantidade,
                        categoria: categoria
                    },
                    success: function () {
                        Swal.fire('Sucesso!', 'Livro editado com sucesso!', 'success');
                        $("#modal-edicao").hide();
                        carregarLivros(); // Atualiza a lista de livros
                    },
                    error: function (retorno) {
                        Swal.fire({
                            title: "Inválido!",
                            text: JSON.parse(retorno.responseText).error,
                            icon: "error"
                        });
                    }
                });
            });
        });

        // Logout do usuário
        document.querySelector(".menu-item button").addEventListener("click", function () {
            localStorage.clear(); // Remove todos os dados do localStorage
            window.location.href = "login.html"; // Redireciona para a página de login
        });
    </script>
</body>

</html>